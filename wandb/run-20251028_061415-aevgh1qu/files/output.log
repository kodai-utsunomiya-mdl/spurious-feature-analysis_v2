wandb is enabled and initialized.
Results will be saved to: results/WB_mf_gradient_basis_2025-10-28_06-14-17
Using device: cuda

--- 1. Preparing Dataset ---

Displaying and saving 10 sample images from the WaterBirds train set...
Sample images saved to results/WB_mf_gradient_basis_2025-10-28_06-14-17/dataset_samples.png

--- Train Set Group Distribution (WaterBirds) ---
Waterbird on Water (y=+1, a=+1)    :  1057 samples
Waterbird on Land (y=+1, a=-1)     :    56 samples
Landbird on Water (y=-1, a=+1)     :   184 samples
Landbird on Land (y=-1, a=-1)      :  3498 samples
Total                              :  4795 samples


--- Test Set Group Distribution (WaterBirds) ---
Waterbird on Water (y=+1, a=+1)    :   642 samples
Waterbird on Land (y=+1, a=-1)     :   642 samples
Landbird on Water (y=-1, a=+1)     :  2255 samples
Landbird on Land (y=-1, a=-1)      :  2255 samples
Total                              :  5794 samples


--- 2. Setting up Model and Optimizer ---

Applying manual parametrization for 'mf'...
        - Input Dim (d): 150528, Hidden Dim (n): 4096, Base LR (Î·): 0.07
        - Input Layer (W^1):        Init Var = 1.00, LR = 2.87e+02
        - Output Layer (W^L+1): Init Var = 1.00, LR = 2.87e+02

--- 3. Starting Training & Evaluation Loop ---
Epoch     1/20000 | Train [Loss: 0.9493, Worst: 1.1048, Acc: 0.7679, Worst: 0.0000] | Test [Loss: 0.9461, Worst: 1.1048, Acc: 0.7784, Worst: 0.0000]

========================= CHECKPOINT ANALYSIS @ EPOCH 1 =========================

Analyzing GRADIENT GRAM MATRIX on Train data...
Traceback (most recent call last):
  File "/home/utsu/sp_v2/main.py", line 233, in <module>
    main(config_path='config.yaml')
  File "/home/utsu/sp_v2/main.py", line 186, in main
    analysis.run_all_analyses(
  File "/home/utsu/sp_v2/analysis.py", line 415, in run_all_analyses
    grad_gram_train_results, group_grads_train = analyze_gradient_gram_matrix(
                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/utsu/sp_v2/analysis.py", line 82, in analyze_gradient_gram_matrix
    grad2_p = grads2[param_idx].flatten()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
